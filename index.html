<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Religion Layer Unique Value Renderer</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    html, body, #viewDiv { height: 100%; width: 100%; margin: 0; padding: 0; }
    #filterDiv { 
      position: absolute; 
      top: 15px; 
      right: 15px; 
      z-index: 10; 
      min-width: 280px;
      background: white; 
      border-radius: 8px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 20px;
    }
    .filter-title {
      color: #495057;
      font-weight: 600;
      margin-bottom: 15px;
    }
    .btn-custom {
      background-color: #007bff;
      border-color: #007bff;
      color: white;
    }
    .btn-custom:hover {
      background-color: #0056b3;
      border-color: #0056b3;
      color: white;
    }
  </style>
</head>
<body>
  <div id="filterDiv">
    <div class="filter-title">
      <i class="fas fa-filter"></i> Filter by Religion
    </div>
    <div class="mb-3">
      <select class="form-select" id="religionDropdown">
        <option value="">All Religions</option>
        <option value="Hindu">Hindu</option>
        <option value="Christian">Christian</option>
        <option value="Muslim">Muslim</option>
        <option value="Sikh">Sikh</option>
        <option value="Jain">Jain</option>
      </select>
    </div>
    <div class="d-grid gap-2">
      <div class="row">
        <div class="col-6">
          <button class="btn btn-custom btn-sm w-100" type="button" id="filterBtn">
            <i class="fas fa-search"></i> Apply Filter
          </button>
        </div>
        <div class="col-6">
          <button class="btn btn-outline-secondary btn-sm w-100" type="button" id="resetBtn">
            <i class="fas fa-undo"></i> Reset
          </button>
        </div>
      </div>
    </div>
  </div>
  <div id="viewDiv"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://kit.fontawesome.com/your-kit-id.js" crossorigin="anonymous"></script>
  <script src="https://js.arcgis.com/4.29/"></script>
  <script>
    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/FeatureLayer"
    ], function(Map, MapView, FeatureLayer) {
      const iconUrls = {
        "Hindu": "https://img.icons8.com/color/48/temple.png",
        "Christian": "https://img.icons8.com/color/48/church.png",
        "Muslim": "https://img.icons8.com/color/48/mosque.png",
        "Sikh": "https://img.icons8.com/color/48/sikhism.png",
        "Jain": "https://img.icons8.com/color/48/temple.png"
      };

      const renderer = {
        type: "unique-value",
        field: "religion",
        uniqueValueInfos: [
          {
            value: "Hindu",
            symbol: {
              type: "picture-marker",
              url: iconUrls["Hindu"],
              width: "24px",
              height: "24px"
            },
            label: "Hindu"
          },
          {
            value: "Christian",
            symbol: {
              type: "picture-marker",
              url: iconUrls["Christian"],
              width: "24px",
              height: "24px"
            },
            label: "Christian"
          },
          {
            value: "Muslim",
            symbol: {
              type: "picture-marker",
              url: iconUrls["Muslim"],
              width: "24px",
              height: "24px"
            },
            label: "Muslim"
          },
          {
            value: "Sikh",
            symbol: {
              type: "picture-marker",
              url: iconUrls["Sikh"],
              width: "24px",
              height: "24px"
            },
            label: "Sikh"
          },
          {
            value: "Jain",
            symbol: {
              type: "picture-marker",
              url: iconUrls["Jain"],
              width: "24px",
              height: "24px"
            },
            label: "Jain"
          }
        ],
        defaultSymbol: {
          type: "simple-marker",
          color: "gray",
          size: 8
        },
        defaultLabel: "Other"
      };

      const religionLayer = new FeatureLayer({
        url: "https://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/Places_of_Worship_India/FeatureServer/0",
        renderer: renderer,
        outFields: ["*"],
        popupTemplate: {
          title: "{name}",
          content: "Religion: {religion}<br>Type: {type}<br>Address: {address}"
        }
      });

      const map = new Map({
        basemap: "streets-navigation-vector",
        layers: [religionLayer]
      });

      const view = new MapView({
        container: "viewDiv",
        map: map,
        center: [78.9629, 20.5937], // Center on India
        zoom: 4
      });

      // Filter functionality
      document.getElementById("filterBtn").onclick = function() {
        const value = document.getElementById("religionDropdown").value;
        if (value) {
          religionLayer.definitionExpression = `religion = '${value}'`;
        } else {
          religionLayer.definitionExpression = null;
        }
      };
      
      document.getElementById("resetBtn").onclick = function() {
        religionLayer.definitionExpression = null;
        document.getElementById("religionDropdown").value = "";
      };

      // Auto-filter on dropdown change
      document.getElementById("religionDropdown").onchange = function() {
        const value = this.value;
        if (value) {
          religionLayer.definitionExpression = `religion = '${value}'`;
        } else {
          religionLayer.definitionExpression = null;
        }
      };
    });
  </script>
</body>
</html>
